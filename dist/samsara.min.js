!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Samsara={})}(this,function(t){"use strict";function e(){this.listeners={},this._owner=this}function i(){e.apply(this,arguments),this.upstream=[],this.upstreamListeners={}}function s(t){i.call(this),this._mappingFunction=t}function n(t){i.call(this),this._condition=t}function o(t){i.call(this),this._splitter=t}function r(){i.call(this)}function a(t){function e(e){var i=t&&t.start?t.start(e):e;i!==!1&&this.emit(he.START,i),a=!1}function s(e){var i=t&&t.update?t.update(e):e;i!==!1&&this.emit(he.UPDATE,i),h=!1}function n(e){var i=t&&t.end?t.end(e):e;i!==!1&&this.emit(he.END,i),u=!1}this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput);var o=0,r=!1,a=!1,h=!1,u=!1;this._eventInput.on(he.START,function(t){return o++,a||r?!1:(a=!0,void se.push(e.bind(this,t)))}.bind(this)),this._eventInput.on(he.UPDATE,function(t){return r=!0,h?!1:(h=!0,void ie.push(s.bind(this,t)))}.bind(this)),this._eventInput.on(he.END,function(t){return o--,r&&o>0?(s.call(this,t),!1):(r=!1,void(u||(u=!0,ne.push(n.bind(this,t)))))}.bind(this)),this._eventInput.on(he.RESIZE,function(t){switch(ee.get()){case ee.STATES.START:this.trigger(he.START,t);break;case ee.STATES.UPDATE:this.trigger(he.UPDATE,t);break;case ee.STATES.END:this.trigger(he.END,t)}}.bind(this))}function h(t){r.call(this),this.value=t,void 0!==t&&this.set(t)}function u(t){this.stream=c(t),i.setOutputHandler(this,this.stream)}function c(t){for(var e in t){var i=t[e];if("number"==typeof i||i instanceof Array){var s=new h(i);t[e]=s}}return a.merge(t)}function p(t){function e(e){var i=t&&t.resize?t.resize(e):e;this.emit(ue.RESIZE,i),s=!1}var s=!1;this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._eventInput.on(ue.RESIZE,function(t){if(!s){var i;switch(ee.get()){case ee.STATES.START:i=se;break;case ee.STATES.UPDATE:i=ie;break;case ee.STATES.END:i=ne}i.push(e.bind(this,t))}s=!0}.bind(this))}function l(t){r.call(this),this.value=t,void 0!==t&&this.set(t)}function d(t){this.stream=f(t),i.setOutputHandler(this,this.stream),this.stream._eventInput.on("start",function(t){this.stream.trigger("resize",t)}.bind(this)),this.stream._eventInput.on("update",function(t){this.stream.trigger("resize",t)}.bind(this)),this.stream._eventInput.on("end",function(t){this.stream.trigger("resize",t)}.bind(this))}function f(t){for(var e in t){var i=t[e];if("number"==typeof i||i instanceof Array){var s=new l(i);t[e]=s}}return p.merge(t)}function v(t){return oe.push(t),t}function y(t){var e=oe.indexOf(t);-1!==e&&oe.splice(e,1)}function _(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function m(t){return Math.sqrt(_(t))}function g(t){return 0>t?-1:1}function b(t){r.call(this),this.state=t||0,this.velocity=0,this._startValue=t||0,this._endValue=0,this._startTime=de(),this._curve=void 0,this._duration=0,this._active=!1,this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput)}function O(t){var e=ve[t];if(void 0!==e)return e;throw new Error("curve not registered")}function I(t,e,i){var s;if(t instanceof Array){s=[];for(var n=0;n<t.length;n++)"number"==typeof t[n]?s.push(T(t[n],e[n],i)):s.push(t[n])}else s=T(t,e,i);return s}function T(t,e,i){return(1-i)*t+i*e}function w(t,e,i,s,n){return(t-e)*(i(n+fe)-i(n-fe))/(2*fe*s)}function E(t,e,i,s,n){var o;if(t instanceof Array){o=[];for(var r=0;r<t.length;r++)"number"==typeof t[r]?o.push(w(t[r],e[r],i,s,n)):o.push(t[r])}else o=w(t,e,i,s,n);return o}function A(t,e){r.call(this),this.value=t||0,this.velocity=e||0,this.target=null,this.startTime=ye(),this.curve=null,this.energy=null,this.energyTolerance=me,this._active=!1,this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput)}function S(t,e){return Math.max(1,Math.abs(e-t))}function D(t,e,i,s,n){return 1>t?z(t,e,i,s,n):1===t?C(t,e,i,s,n):M(t,e,i,s,n)}function N(t){var e=2*Math.PI/t;return function(t,i,s){var n=t-i,o=e*e*n*n,r=s*s;return r+o}}function z(t,e,i,s,n){var o=Math.sqrt(1-t*t)/e,r=i-s,a=(t/e*r+n)/o;return function(i){return s+Math.exp(-t*i/e)*(r*Math.cos(o*i)+a*Math.sin(o*i))}}function C(t,e,i,s,n){var o=i-s,r=n+o/e;return function(i){return s+Math.exp(-t*i/e)*(o+r*i)}}function M(t,e,i,s,n){var o=Math.sqrt(t*t-1)/e,r=-t/e+o,a=-t/e-o,h=i-s,u=(r*h-n)/(a-r),c=h+u,p=-u;return function(t){return s+c*Math.exp(r*t)+p*Math.exp(a*t)}}function P(t,e){r.call(this),this.value=t||0,this.velocity=e||0,this.drag=0,this.energy=null,this._active=!1,this._previousTime=ge(),this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput)}function x(t){this.value=t||0,this.velocity=0,this._callback=void 0,this._method=null,this._active=!1,this._currentActive=!1;var e=!1;this.updateMethod=void 0,this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._eventInput.on("start",function(t){this._currentActive=!0,this._active||(this.emit("start",t),this._active=!0)}.bind(this)),this._eventInput.on("update",function(t){e=!0,this.value=t,this.velocity=this._engineInstance.getVelocity(),this.emit("update",t)}.bind(this)),this._eventInput.on("end",function(t){if(this.value=t,this._currentActive=!1,this._callback){var i=this._callback;this._callback=void 0,i()}this._currentActive||(this._active=!1,e=!1,this._engineInstance&&(this.velocity=this._engineInstance.getVelocity()),this._active=!1,this.emit("end",t))}.bind(this)),void 0!==t&&(this.value=t,se.push(function(){this.trigger("start",t),ne.push(function(){e||this.trigger("end",t)}.bind(this))}.bind(this)))}function L(t,e){this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput),this.sources=[];for(var s=0;s<t.length;s++){var n=new e(t[s]);this.sources.push(n)}this.stream=a.merge(this.sources),this._eventOutput.subscribe(this.stream)}function R(t,e,i){var s=void 0!==e.opacity?e.opacity:Ie.OPACITY,n=e.transform||Ie.TRANSFORM,o=t.origin||Ie.ORIGIN,r=t.align||Ie.ALIGN,a=void 0!==t.opacity?s*t.opacity:s,h=t.transform?le.compose(n,t.transform):n,u=t.origin?n:e.nextSizeTransform||n;if(t.size&&(u=n),o&&(o[0]||o[1])){var c="number"==typeof i[0]?-o[0]*i[0]:0,p="number"==typeof i[1]?-o[1]*i[1]:0;h=le.moveThen([c,p,0],h),o=null}if(i&&r&&(r[0]||r[1])){var l=k([r[0]*i[0],r[1]*i[1],0],u);h=le.thenMove(h,l),r=null}return{transform:h,opacity:a,origin:o,align:r,nextSizeTransform:u}}function k(t,e){return[t[0]*e[0]+t[1]*e[4]+t[2]*e[8],t[0]*e[1]+t[1]*e[5]+t[2]*e[9],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]]}function F(t,e){if(!t)return e;var i=new Array(2);return t.size&&(void 0===t.size[0]&&(i[0]=e[0]),void 0===t.size[1]&&(i[1]=e[1]),"number"==typeof t.size[0]&&(i[0]=t.size[0]),"number"==typeof t.size[1]&&(i[1]=t.size[1]),t.size[0]===!0&&(i[0]=!0),t.size[1]===!0&&(i[1]=!0)),t.proportions&&("number"==typeof t.proportions[0]&&(i[0]=t.proportions[0]*e[0]),"number"==typeof t.proportions[1]&&(i[1]=t.proportions[1]*e[1])),t.aspectRatio&&("number"==typeof i[0]?i[1]=t.aspectRatio*i[0]:"number"==typeof i[1]&&(i[0]=t.aspectRatio*i[1])),void 0===i[0]&&(i[0]=e[0]),void 0===i[1]&&(i[1]=e[1]),t.margins&&(i[0]-=2*t.margins[0],i[1]-=2*t.margins[1]),i}function H(t){this._layout=new i,this._size=new i,this.size=null,this.layout=null,this.root=null,t&&V.call(this,t)}function Y(t){var e={},i={};for(var s in t)Te[s]?e[s]=t[s]:we[s]&&(i[s]=t[s]);var n=this,o=Object.keys(e).length>0,r=Object.keys(i).length>0;if(o&&i.align){var a=new u({align:i.align});delete i.align,n=n.add(a)}return o&&(n=n.add(new d(e))),r&&(n=n.add(new u(i))),n}function X(){return this.root?this.root:this.tempRoot?X.call(this.tempRoot):this}function V(t){return t instanceof d?void(this.size=p.lift(function(t,e){return e?t?F(t,e):e:!1},[t,this._size])):t instanceof u?void(this.layout=a.lift(function(t,e,i){return e&&i?t?R(t,e,i):e:!1},[t,this._layout,this._size])):(t._size.subscribe(this._size),t._layout.subscribe(this._layout),void(t._getRoot=X.bind(this)))}function B(t){this._value=t,this._eventHandler=null}function U(){this._eventHandler||(this._eventHandler=new i)}function j(t){var e;if("object"==typeof t){e=t instanceof Array?[]:{};for(var i in t){var s=t[i];if("object"==typeof s&&null!==s)if(s instanceof Array){e[i]=[];for(var n=0;n<s.length;n++)e[i][n]=j(s[n])}else e[i]=j(s);else e[i]=s}}else e=t;return e}function G(t){this.options=q(this.constructor.DEFAULT_OPTIONS||G.DEFAULT_OPTIONS),this._optionsManager=new B(this.options),t&&this.setOptions(t),this.input=new r,this.output=new r,i.setInputHandler(this,this.input),i.setOutputHandler(this,this.output),i.setInputEvents(this,this.constructor.EVENTS||G.EVENTS,this.input),this.input.bindThis(this),this.input.subscribe(this._optionsManager),this.initialize&&this.initialize(this.options)}function q(t){var e;if("object"==typeof t){e=t instanceof Array?[]:{};for(var i in t){var s=t[i];if("object"==typeof s&&null!==s)if(s instanceof Array){e[i]=[];for(var n=0;n<s.length;n++)e[i][n]=q(s[n])}else e[i]=q(s);else e[i]=s}}else e=t;return e}function Z(t,e){var i=this,s=t.hasOwnProperty("constructor")?function(){t.constructor.apply(this,arguments)}:function(){i.apply(this,arguments)};s.extend=Z,s.prototype=Object.create(i.prototype),s.prototype.constructor=s;for(var n in t){var o=t[n];switch(n){case Ee.DEFAULTS:s.DEFAULT_OPTIONS=o;break;case Ee.EVENTS:if(s.EVENTS)for(var n in o)s.EVENTS[n]=o[n];else s.EVENTS=o;break;default:s.prototype[n]=o}}for(var n in e)s[n]=e[n];return s}function K(t){for(var e in t){var i=t[e];switch(e){case"size":this.setSize(i);break;case"proportions":this.setProportions(i);break;case"aspectRatio":this.setAspectRatio(i);break;case"origin":this.setOrigin(i);break;case"opacity":this.setOpacity(i)}}}function W(t){this._currentTarget=null,this._cachedSpec={transform:null,opacity:1,origin:null,size:null},this._eventOutput=new i,i.setOutputHandler(this,this._eventOutput),this._eventForwarder=function(t){this._eventOutput.emit(t.type,t)}.bind(this),this._sizeNode=new d,this._layoutNode=new u,this._size=new i,this._layout=new i,this.size=p.lift(function(t,e){return e?F(t,e):!1},[this._sizeNode,this._size]),this.layout=a.lift(function(t,e,i){return t&&i?e?R(e,t,i):t:!1},[this._layout,this._layoutNode,this.size]),this.layout.on("start",function(){if(!this._currentTarget){var t=this._getRoot();this.setup(t.allocator)}}.bind(this)),this.layout.on("update",st.bind(this)),this.layout.on("end",st.bind(this)),this.size.on("resize",function(t){if(!this._currentTarget){var e=this._getRoot();this.setup(e.allocator)}nt.call(this,t)}.bind(this)),this._currentTarget=null,this._opacityDirty=!0,this._originDirty=!0,this._transformDirty=!0,this._isVisible=!0,t&&this.attach(t)}function J(t){for(var e in this._eventOutput.listeners)t.addEventListener(e,this._eventForwarder)}function Q(t){for(var e in this._eventOutput.listeners)t.removeEventListener(e,this._eventForwarder)}function $(t,e){return 1===e?Math.round(t):Math.round(t*e)/e}function tt(t,e){for(var i="matrix3d(",s=0;15>s;s++)Math.abs(t[s])<Ce&&(t[s]=0),i+=12===s||13===s?$(t[s],e)+",":t[s]+",";return i+t[15]+")"}function et(t){return 100*t[0]+"% "+100*t[1]+"%"}function it(t,e){return t&&e?t[0]!==e[0]||t[1]!==e[1]:t!==e}function st(t){var e=this._currentTarget;if(e){var i=this._cachedSpec,s=t.transform||le.identity,n=void 0===t.opacity?1:t.opacity,o=t.origin||Me;this._transformDirty=le.notEquals(i.transform,s),this._opacityDirty=this._opacityDirty||i.opacity!==n,this._originDirty=this._originDirty||o&&it(i.origin,o),this._opacityDirty&&(i.opacity=n,Re.call(this,e,n)),this._originDirty&&(i.origin=o,Pe(e,o)),this._transformDirty&&(i.transform=s,xe(e,s,this.roundToPixel?1:De)),this._originDirty=!1,this._transformDirty=!1,this._opacityDirty=!1}}function nt(t){var e=this._currentTarget;e&&(t[0]!==!0&&(t[0]=$(t[0],De)),t[1]!==!0&&(t[1]=$(t[1],De)),it(this._cachedSpec.size,t)&&(this._cachedSpec.size=t,Le(e,t),this.emit("resize",t)))}function ot(t){this.properties={},this.attributes={},this.content="",this.classList=[],this._contentDirty=!0,this._dirtyClasses=[],this._classesDirty=!0,this._stylesDirty=!0,this._attributesDirty=!0,this._dirty=!1,this._cachedSize=null,this._allocator=null,t?(t.el&&!t.size&&(this._contentDirty=!1,t.size=[!0,!0]),W.call(this,t.el),this.setOptions(t)):W.call(this)}function rt(){!this._dirty&&this._currentTarget&&ne.push(function(){var t=this._currentTarget;t&&(this._classesDirty&&(ct.call(this,t),at.call(this,t)),this._stylesDirty&&ht.call(this,t),this._attributesDirty&&ut.call(this,t),this._contentDirty&&this.deploy(t),this._dirty=!1)}.bind(this))}function at(t){for(var e=0;e<this.classList.length;e++)t.classList.add(this.classList[e]);this._classesDirty=!1}function ht(t){for(var e in this.properties)t.style[e]=this.properties[e];this._stylesDirty=!1}function ut(t){for(var e in this.attributes)t.setAttribute(e,this.attributes[e]);this._attributesDirty=!1}function ct(t){for(var e=0;e<this._dirtyClasses.length;e++)t.classList.remove(this._dirtyClasses[e]);this._dirtyClasses=[]}function pt(t){for(var e in this.properties)t.style[e]=""}function lt(t){for(var e in this.attributes)t.removeAttribute(e)}function dt(){this.addClass("samsara-scrollable"),ke&&this.on("deploy",function(t){He&&t.addEventListener("touchstart",function(){var e=t.scrollTop,i=t.offsetHeight,s=t.scrollHeight;0==e?t.scrollTop=1:e+i==s&&(t.scrollTop=s-i-1)},!1),t.addEventListener("touchmove",function(t){t.stopPropagation()},!1)})}function ft(t){H.call(this),this.root=this,t&&this.setAllocator(t)}function vt(t){t||(t=document.createDocumentFragment()),this.container=t,this.detachedNodes={}}function yt(t){this.options=B.setOptions(this,t,yt.DEFAULT_OPTIONS),this._node=new ft,this._size=new r,this._layout=new r,this.size=this._size.map(function(){var t=[this.container.clientWidth,this.container.clientHeight];return this.emit("resize",t),t}.bind(this)),this._node._size.subscribe(this.size),this._node._layout.subscribe(this._layout),this._perspective=new x,this._perspectiveOrigin=new x,this._perspective.on("update",function(t){this.container&&Ze(this.container,t)}.bind(this)),this._perspective.on("end",function(t){this.container&&Ze(this.container,t)}.bind(this)),this._perspectiveOrigin.on("update",function(t){this.container&&Ke(this.container,t)}.bind(this)),this._perspectiveOrigin.on("end",function(t){this.container&&Ke(this.container,t)}.bind(this)),this._eventOutput=new i,this._eventForwarder=function(t){this._eventOutput.emit(t.type,t)}.bind(this),this.options.enableScroll===!1&&this.on("deploy",function(t){t.addEventListener("touchmove",function(t){t.preventDefault()},!1)})}function _t(t){return 100*t[0]+"% "+100*t[1]+"%"}function mt(){var t=window.innerHeight,e=window.innerWidth;if(Ve){var i=t>e;if(Be===i)return!1;Be=i}else{if(e===Ue&&t===je)return!1;Ue=e,je=t}this._size.emit("resize"),ne.push(function(){this._size.emit("resize")}.bind(this))}function gt(t){ot.call(this,t),this.context=new yt,this.context._size.subscribe(this.size),this.on("deploy",function(t){this.context.mount(t,!0)}.bind(this))}function bt(t,e){this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._inputs={},t&&this.addInput(t),e&&this.setOptions(e)}function Ot(t,e){We[t]&&(this._inputs[t]=new We[t](e),this.subscribeInput(t))}function It(t){this.options=B.setOptions(this,t),this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._eventInput.on("mousedown",Tt.bind(this)),this._eventInput.on("mousemove",wt.bind(this)),this._eventInput.on("mouseup",Et.bind(this)),this._eventInput.on("mouseleave",At.bind(this)),this._payload={delta:null,value:null,cumulate:null,velocity:null,clientX:0,clientY:0,offsetX:0,offsetY:0},this._value=null,this._cumulate=null,this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,this._move=!1}function Tt(t){var e,i;t.preventDefault();var s=t.clientX,n=t.clientY;this._prevCoord=[s,n],this._prevTime=Qe(),this._down=!0,this._move=!1,void 0!==this.options.direction?(null===this._cumulate&&(this._cumulate=0),this._value=0,e=0,i=0):(null===this._cumulate&&(this._cumulate=[0,0]),this._value=[0,0],e=[0,0],i=[0,0]);var o=this._payload;o.delta=e,o.value=this._value,o.cumulate=this._cumulate,o.velocity=i,o.clientX=s,o.clientY=n,o.offsetX=t.offsetX,o.offsetY=t.offsetY,this._eventOutput.emit("start",o)}function wt(t){if(!this._down)return!1;var e,i,s=this.options.scale,n=this._prevCoord,o=this._prevTime,r=t.clientX,a=t.clientY,h=Qe(),u=s*(r-n[0]),c=s*(a-n[1]),p=Math.max(h-o,Je),l=1/p,d=u*l,f=c*l;this.options.direction===It.DIRECTION.X?(i=u,e=d,this._value+=i,this._cumulate+=i):this.options.direction===It.DIRECTION.Y?(i=c,e=f,this._value+=i,this._cumulate+=i):(i=[u,c],e=[d,f],this._value[0]+=i[0],this._value[1]+=i[1],this._cumulate[0]+=i[0],this._cumulate[1]+=i[1]);var v=this._payload;v.delta=i,v.value=this._value,v.cumulate=this._cumulate,v.velocity=e,v.clientX=r,v.clientY=a,v.offsetX=t.offsetX,v.offsetY=t.offsetY,this._eventOutput.emit("update",v),this._prevCoord=[r,a],this._prevTime=h,this._move=!0}function Et(){return this._down?(this._eventOutput.emit("end",this._payload),this._prevCoord=void 0,this._prevTime=void 0,this._down=!1,void(this._move=!1)):!1}function At(t){if(this._down&&this._move){var e=wt.bind(this),i=function(t){Et.call(this,t),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",i)}.bind(this,t);document.addEventListener("mousemove",e),document.addEventListener("mouseup",i)}}function St(t){this.options=B.setOptions(this,t),this.touchHistory={},this._isTouched=!1,this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._eventInput.on("touchstart",Nt.bind(this)),this._eventInput.on("touchmove",zt.bind(this)),this._eventInput.on("touchend",Ct.bind(this)),this._eventInput.on("touchcancel",Ct.bind(this))}function Dt(t,e,i){return{x:t.clientX,y:t.clientY,identifier:t.identifier,timestamp:$e(),count:e.touches.length,history:i}}function Nt(t){if(!(t.touches.length>this.options.limit)){this._isTouched=!0;for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],s=Dt(i,t,null);this._eventOutput.emit("trackstart",s),this.touchHistory[i.identifier]||this.track(s)}}}function zt(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],s=this.touchHistory[i.identifier];if(s){var n=Dt(i,t,s);this.touchHistory[i.identifier].push(n),this._eventOutput.emit("trackmove",n)}}}function Ct(t){if(this._isTouched){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e],s=this.touchHistory[i.identifier];if(s){var n=Dt(i,t,s);this._eventOutput.emit("trackend",n),delete this.touchHistory[i.identifier]}}this._isTouched=!1}}function Mt(t){this.options=B.setOptions(this,t),this._eventOutput=new i,this._touchTracker=new St,i.setOutputHandler(this,this._eventOutput),i.setInputHandler(this,this._touchTracker),this._touchTracker.on("trackstart",Pt.bind(this)),this._touchTracker.on("trackmove",xt.bind(this)),this._touchTracker.on("trackend",Lt.bind(this)),this._payload={delta:null,value:null,cumulate:null,velocity:null,clientX:void 0,clientY:void 0,count:0,touchId:void 0},this._cumulate=null,this._value=null}function Pt(t){var e,i;void 0!==this.options.direction?(null===this._cumulate&&(this._cumulate=0),this._value=0,e=0,i=0):(null===this._cumulate&&(this._cumulate=[0,0]),this._value=[0,0],e=[0,0],i=[0,0]);var s=this._payload;s.delta=i,s.value=this._value,s.cumulate=this._cumulate,s.velocity=e,s.clientX=t.x,s.clientY=t.y,s.count=t.count,s.touchId=t.identifier,this._eventOutput.emit("start",s)}function xt(t){var e,i,s=this.options.scale,n=t.history,o=n[n.length-1],r=n[n.length-2],a=r.timestamp,h=o.timestamp,u=s*(o.x-r.x),c=s*(o.y-r.y),p=Math.max(h-a,ti),l=1/p,d=u*l,f=c*l;this.options.direction===Mt.DIRECTION.X?(i=u,e=d,this._value+=i,this._cumulate+=i):this.options.direction===Mt.DIRECTION.Y?(i=c,e=f,this._value+=i,this._cumulate+=i):(i=[u,c],e=[d,f],this._value[0]+=i[0],this._value[1]+=i[1],this._cumulate[0]+=i[0],this._cumulate[1]+=i[1]);var v=this._payload;v.delta=i,v.velocity=e,v.value=this._value,v.cumulate=this._cumulate,v.clientX=t.x,v.clientY=t.y,v.count=t.count,v.touchId=t.identifier,this._eventOutput.emit("update",v)}function Lt(t){this._payload.count=t.count,this._eventOutput.emit("end",this._payload)}function Rt(t){this.options=B.setOptions(this,t),this._payload={delta:null,value:null,cumulate:null,velocity:null,clientX:void 0,clientY:void 0,offsetX:void 0,offsetY:void 0},this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this._eventInput.on("wheel",kt.bind(this)),this._value=void 0===this.options.direction?[0,0]:0,this._cumulate=void 0===this.options.direction?[0,0]:0,this._prevTime=void 0,this._inProgress=!1;var e=this;this._scrollEnd=ce.debounce(function(){e._inProgress=!1,0!==e._payload.delta&&(e._payload.velocity=0),e._eventOutput.emit("end",e._payload)},100)}function kt(t){if(t.preventDefault(),!this._inProgress)return this._value=void 0===this.options.direction?[0,0]:0,p=this._payload,p.value=this._value,p.cumulate=this._cumulate,p.clientX=t.clientX,p.clientY=t.clientY,p.offsetX=t.offsetX,p.offsetY=t.offsetY,this._eventOutput.emit("start",p),void(this._inProgress=!0);var e=si(),i=this._prevTime||e,s=-t.deltaX,n=-t.deltaY;s>ii&&(s=ii),n>ii&&(n=ii),-ii>s&&(s=-ii),-ii>n&&(n=-ii);var o=1/Math.max(e-i,ei);this._prevTime=e;var r,a,h=s*o,u=n*o,c=this.options.scale;this.options.direction===Rt.DIRECTION.X?(a=c*s,r=c*h,this._value+=a,this._cumulate+=a):this.options.direction===Rt.DIRECTION.Y?(a=c*n,r=c*u,this._value+=a,this._cumulate+=a):(a=[c*s,c*n],r=[c*h,c*u],this._value[0]+=a[0],this._value[1]+=a[1],this._cumulate[0]+=a[0],this._cumulate[1]+=a[1]);var p=this._payload;p.delta=a,p.velocity=r,p.value=this._value,p.cumulate=this._cumulate,this._eventOutput.emit("update",p),this._scrollEnd()}function Ft(){this._eventInput=new i,this._eventOutput=new i,i.setInputHandler(this,this._eventInput),i.setOutputHandler(this,this._eventOutput),this.touchAEnabled=!1,this.touchAId=0,this.posA=null,this.timestampA=0,this.touchBEnabled=!1,this.touchBId=0,this.posB=null,this.timestampB=0,this._eventInput.on("touchstart",this.handleStart.bind(this)),this._eventInput.on("touchmove",this.handleMove.bind(this)),this._eventInput.on("touchend",this.handleEnd.bind(this)),this._eventInput.on("touchcancel",this.handleEnd.bind(this))}function Ht(t){Ft.call(this),this.options=B.setOptions(this,t),this._startDist=0,this._scaleFactor=1}function Yt(t){Ft.call(this),this.options=B.setOptions(this,t),this._angle=0,this._previousAngle=0}function Xt(t){Ft.call(this),this.options=B.setOptions(this,t),this._displacement=0,this._previousDistance=0}function Vt(t){this.options=B.setOptions(this,t);var e=void 0,i=void 0;a.call(this,{update:function(){return i}}),this._eventInput.on("start",function(t){e=t instanceof Array?t.slice():t}),this._eventInput.on("update",function(t){var s=this.options.scale;if(e instanceof Array){i=[];for(var n=0;n<e.length;n++)i[n]=s*(t[n]-e[n]),e[n]=t[n]}else i=s*(t-e),e=t}.bind(this))}function Bt(t,e){this.options=B.setOptions(this,e),this.sum=void 0,void 0!==t&&this.set(t),a.call(this,{start:function(){return this.sum||0}.bind(this),update:function(){return this.sum}.bind(this),end:function(){return this.sum||0}.bind(this)}),this._eventInput.on("start",function(t){if(void 0===this.sum)if(t instanceof Array){this.sum=[];for(var e=0;e<t.length;e++)this.sum[e]=Ut(t[e],this.options.min,this.options.max)}else this.sum=Ut(t,this.options.min,this.options.max)}.bind(this)),this._eventInput.on("update",function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)this.sum[e]+=t[e],this.sum[e]=Ut(this.sum[e],this.options.min,this.options.max);else this.sum+=t,this.sum=Ut(this.sum,this.options.min,this.options.max)}.bind(this))}function Ut(t,e,i){return Math.min(Math.max(t,e),i)}function jt(t){var e=oi.SIDE,i=oi.DIRECTION;return t===e.LEFT||t===e.RIGHT?i.X:i.Y}function Gt(t){var e=oi.SIDE;return t===e.LEFT||t===e.TOP?oi.ORIENTATION.POSITIVE:oi.ORIENTATION.NEGATIVE}function qt(t){var e=t.key,i=t.value;"side"!==e&&(this.direction=jt(i),this.orientation=Gt(i)),this.options.revealLength*=this.direction}function Zt(t,e){for(var i in t)if(e<=parseInt(i))break;return t[i]}function Kt(t){t!=this._previousIndex&&(this.emit("page",t),this._previousIndex=t)}function Wt(t,e){this.drag.halt(),this.spring.reset(t),this.options.edgeTransition.velocity=e,this.spring.set(0,this.options.edgeTransition)}function Jt(t){var e,i=this.options.pageChangeSpeed,s=this.items[this._currentIndex].getSize()[this.options.direction],n=this.itemOffset,o=this.itemOffset-s,r=this.itemOffset,a=s/2;e=0>t?r>a||-i>t?o:n:a>r||t>i?n:o,this.options.pageTransition.velocity=t,this.spring.halt(),this.spring.reset(-e),this.spring.set(0,this.options.pageTransition)}function Qt(t){this.drag.halt(),this.drag.reset(0),this.drag.set(0,{curve:"inertia",velocity:t,drag:this.options.drag})}var $t={NONE:-1,START:0,UPDATE:1,END:2},te=$t.START,ee={};ee.STATES=$t,ee.set=function(t){te=t},ee.get=function(){return te};var ie=[],se=[],ne=[],oe=[],re=0,ae={};ae.step=function(){for(;se.length;)se.shift()();ee.set(ee.STATES.UPDATE);for(var t=0;t<oe.length;t++)oe[t]();for(;ie.length;)ie.shift()();for(ee.set(ee.STATES.END);ne.length;)ne.shift()();ee.set(ee.STATES.START)},ae.start=function vi(){ae.step(),re=window.requestAnimationFrame(vi)},ae.stop=function(){window.cancelAnimationFrame(re)},e.prototype.emit=function(t,e){if(e!==!1){var i=this.listeners[t];if(i)for(var s=0;s<i.length;s++)i[s].call(this._owner,e)}},e.prototype.trigger=e.prototype.emit,e.prototype.on=function(t,e){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push(e)},e.prototype.once=function(t,i){var s=function(){e.prototype.off.call(this,t,s),i.apply(this,arguments)}.bind(this);this.on(t,s)},e.prototype.off=function(t,e){if(!t)return void(this.listeners={});var i=this.listeners[t];if(void 0!==i)if(e){var s=i.indexOf(e);s>=0&&i.splice(s,1)}else this.listeners[t]=[]},e.prototype.bindThis=function(t){this._owner=t},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.setInputHandler=function(t,e){t.trigger=e.trigger.bind(e),t.subscribe=e.subscribe.bind(e),t.unsubscribe=e.unsubscribe.bind(e)},i.setOutputHandler=function(t,e){e.bindThis(t),t.emit=e.emit.bind(e),t.on=e.on.bind(e),t.off=e.off.bind(e)},i.setInputEvents=function(t,e,i){for(var s in e){var n=e[s],o="string"==typeof n?t[n]:n;o&&i.on(s,o.bind(t))}},i.prototype.on=function(t,i){if(e.prototype.on.apply(this,arguments),!(t in this.upstreamListeners)){var s=this.trigger.bind(this,t);this.upstreamListeners[t]=s;for(var n=0;n<this.upstream.length;n++)this.upstream[n].on(t,s)}},i.prototype.subscribe=function(t){var e=this.upstream.indexOf(t);if(0>e){this.upstream.push(t);for(var i in this.upstreamListeners)t.on(i,this.upstreamListeners[i])}return t},i.prototype.unsubscribe=function(t){var e=this.upstream.indexOf(t);if(e>=0){this.upstream.splice(e,1);for(var i in this.upstreamListeners)t.off(i,this.upstreamListeners[i])}return t},s.prototype=Object.create(i.prototype),s.prototype.constructor=s,s.prototype.emit=function(t,e){var s=this._mappingFunction(e);i.prototype.emit.call(this,t,s)},s.prototype.trigger=s.prototype.emit,n.prototype=Object.create(i.prototype),n.prototype.constructor=n,n.prototype.emit=function(t,e){this._condition(e)&&i.prototype.emit.apply(this,arguments)},n.prototype.trigger=n.prototype.emit,o.prototype=Object.create(i.prototype),o.prototype.constructor=o,o.prototype.emit=function(t,e){var i=this._splitter.apply(this,arguments);i&&i.emit instanceof Function&&i.emit(t,e)},o.prototype.trigger=o.prototype.emit,r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.map=function(t){var e=new r,i=new s(t);return e.subscribe(i).subscribe(this),e},r.prototype.filter=function(t){var e=new n(t),i=new r;return i.subscribe(e).subscribe(this),i},r.prototype.split=function(t){var e=new o(t),i=new r;return i.subscribe(e).subscribe(this),i},r.prototype.pluck=function(t){return this.map(function(e){return e[t]})},r.merge=function(){},r.lift=function(t,e){var i=e instanceof Array?this.merge(e):this.merge.apply(null,Array.prototype.splice.call(arguments,1)),n=new s(function(e){return t.apply(null,e)}),o=new r;return o.subscribe(n).subscribe(i),o};var he={START:"start",UPDATE:"update",END:"end",RESIZE:"resize"};a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.lift=r.lift,a.merge=function(t){var e=new a,i=t instanceof Array?[]:{};e.addStream=function(t,n){var o=function(t){return new s(function(e){return i[t]=e,i})}(t);e.subscribe(o).subscribe(n)};for(var n in t){var o=t[n];e.addStream(n,o)}return e},h.prototype=Object.create(r.prototype),h.prototype.constructor=h,h.prototype.get=function(){return this.value},h.prototype.set=function(t){var e=this;se.push(function(){e.value=t,e.emit("start",t),ne.push(function(){e.emit("end",t)})})},u.KEYS={transform:"transform",origin:"origin",align:"align",opacity:"opacity"},u.prototype.set=function(t){for(var e in t){var i=t[e],s=i instanceof r?i:new h(i);this.stream.addStream(e,s)}};var ue={RESIZE:"resize"};p.prototype=Object.create(r.prototype),p.prototype.constructor=p,p.lift=r.lift,p.merge=function(t){var e=new p,i=t instanceof Array?[]:{};e.addStream=function(t,n){var o=function(t){return new s(function(e){return i[t]=e,i})}(t);e.subscribe(o).subscribe(n)};for(var n in t){var o=t[n];e.addStream(n,o)}return e},l.prototype=Object.create(r.prototype),l.prototype.constructor=l,l.prototype.get=function(){return this.value},l.prototype.set=function(t){var e=this;se.push(function(){e.value=t,e.emit("resize",t),ne.push(function(){e.emit("resize",t)})})},d.KEYS={size:"size",proportions:"proportions",margins:"margins",aspectRatio:"aspectRatio"},d.prototype.set=function(t){for(var e in t){var i=t[e],s=i instanceof r?i:new l(i);this.stream.addStream(e,s)}};var ce={},pe=window.performance?function(){return window.performance.now()}:Date.now;ce.setTimeout=function(t,e){var i=pe(),s=function(){var n=pe();n-i>=e&&(t.apply(this,arguments),ce.clear(s))};return v(s)},ce.setInterval=function(t,e){var i=pe(),s=function(){var s=pe();s-i>=e&&(t.apply(this,arguments),i=pe())};return v(s)},ce.after=function(t,e){if(void 0!==e){var i=function(){e--,0>=e&&(t.apply(this,arguments),ce.clear(i))};return v(i)}},ce.every=function(t,e){e=e||1;var i=e,s=function(){e--,0>=e&&(t.apply(this,arguments),e=i)};return v(s)},ce.clear=function(t){y(t)},ce.debounce=function(t,e){var i;return function(){var s=arguments,n=function(){ce.clear(i),i=null,t.apply(this,s)}.bind(this);i&&ce.clear(i),i=ce.setTimeout(n,e)}},ce.frameDebounce=function(t,e){var i;return function(){var s=arguments,n=function(){i=null,t.apply(this,s)}.bind(this);i&&ce.clear(i),i=ce.after(n,e)}};var le={};le.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],le.inFront=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,1.001,1],le.behind=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,-1.001,1],le.compose=function(t,e){return t===le.identity?e.slice():e===le.identity?t.slice():[t[0]*e[0]+t[4]*e[1]+t[8]*e[2],t[1]*e[0]+t[5]*e[1]+t[9]*e[2],t[2]*e[0]+t[6]*e[1]+t[10]*e[2],0,t[0]*e[4]+t[4]*e[5]+t[8]*e[6],t[1]*e[4]+t[5]*e[5]+t[9]*e[6],t[2]*e[4]+t[6]*e[5]+t[10]*e[6],0,t[0]*e[8]+t[4]*e[9]+t[8]*e[10],t[1]*e[8]+t[5]*e[9]+t[9]*e[10],t[2]*e[8]+t[6]*e[9]+t[10]*e[10],0,t[0]*e[12]+t[4]*e[13]+t[8]*e[14]+t[12],t[1]*e[12]+t[5]*e[13]+t[9]*e[14]+t[13],t[2]*e[12]+t[6]*e[13]+t[10]*e[14]+t[14],1]},le.composeMany=function(){if(arguments.length>2){var t=arguments[0],e=arguments[1];return Array.prototype.shift.call(arguments),arguments[0]=le.compose(t,e),le.composeMany.apply(null,arguments)}return le.compose.apply(null,arguments)},le.thenMove=function(t,e){return e[2]||(e[2]=0),
[t[0],t[1],t[2],0,t[4],t[5],t[6],0,t[8],t[9],t[10],0,t[12]+e[0],t[13]+e[1],t[14]+e[2],1]},le.moveThen=function(t,e){t[2]||(t[2]=0);var i=t[0]*e[0]+t[1]*e[4]+t[2]*e[8],s=t[0]*e[1]+t[1]*e[5]+t[2]*e[9],n=t[0]*e[2]+t[1]*e[6]+t[2]*e[10];return le.thenMove(e,[i,s,n])},le.translate=function(t){var e=t[0]||0,i=t[1]||0,s=t[2]||0;return[1,0,0,0,0,1,0,0,0,0,1,0,e,i,s,1]},le.translateX=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,t,0,0,1]},le.translateY=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,0,t,0,1]},le.translateZ=function(t){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1]},le.scale=function(t){var e=void 0!==t[0]?t[0]:1,i=void 0!==t[1]?t[1]:1,s=void 0!==t[2]?t[2]:1;return[e,0,0,0,0,i,0,0,0,0,s,0,0,0,0,1]},le.scaleX=function(t){return[t,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},le.scaleY=function(t){return[1,0,0,0,0,t,0,0,0,0,1,0,0,0,0,1]},le.scaleZ=function(t){return[1,0,0,0,0,1,0,0,0,0,t,0,0,0,0,1]},le.thenScale=function(t,e){var i=void 0!==e[0]?e[0]:1,s=void 0!==e[1]?e[1]:1,n=void 0!==e[2]?e[2]:1;return[i*t[0],s*t[1],n*t[2],0,i*t[4],s*t[5],n*t[6],0,i*t[8],s*t[9],n*t[10],0,i*t[12],s*t[13],n*t[14],1]},le.rotateX=function(t){var e=Math.cos(t),i=Math.sin(t);return[1,0,0,0,0,e,i,0,0,-i,e,0,0,0,0,1]},le.rotateY=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,0,-i,0,0,1,0,0,i,0,e,0,0,0,0,1]},le.rotateZ=function(t){var e=Math.cos(t),i=Math.sin(t);return[e,i,0,0,-i,e,0,0,0,0,1,0,0,0,0,1]},le.skewX=function(t){return[1,0,0,0,Math.tan(t),1,0,0,0,0,1,0,0,0,0,1]},le.skewY=function(t){return[1,Math.tan(t),0,0,0,1,0,0,0,0,1,0,0,0,0,1]},le.rotateAxis=function(t,e){var i=Math.sin(e),s=1-Math.cos(e),n=1-s,o=t[0]*t[0]*n,r=t[0]*t[1]*n,a=t[0]*t[2]*n,h=t[1]*t[1]*n,u=t[1]*t[2]*n,c=t[2]*t[2]*n,p=t[0]*i,l=t[1]*i,d=t[2]*i;return[o+s,r+d,a-l,0,r-d,h+s,u+p,0,a+l,u-p,c+s,0,0,0,0,1]},le.aboutOrigin=function(t,e){t[2]=t[2]||0;var i=t[0]-(t[0]*e[0]+t[1]*e[4]+t[2]*e[8]),s=t[1]-(t[0]*e[1]+t[1]*e[5]+t[2]*e[9]),n=t[2]-(t[0]*e[2]+t[1]*e[6]+t[2]*e[10]);return le.thenMove(e,[i,s,n])},le.perspective=function(t){return[1,0,0,0,0,1,0,0,0,0,1,-1/t,0,0,0,1]},le.getTranslate=function(t){return[t[12],t[13],t[14]]},le.inverse=function(t){var e=t[5]*t[10]-t[6]*t[9],i=t[4]*t[10]-t[6]*t[8],s=t[4]*t[9]-t[5]*t[8],n=t[1]*t[10]-t[2]*t[9],o=t[0]*t[10]-t[2]*t[8],r=t[0]*t[9]-t[1]*t[8],a=t[1]*t[6]-t[2]*t[5],h=t[0]*t[6]-t[2]*t[4],u=t[0]*t[5]-t[1]*t[4],c=t[0]*e-t[1]*i+t[2]*s,p=1/c,l=[p*e,-p*n,p*a,0,-p*i,p*o,-p*h,0,p*s,-p*r,p*u,0,0,0,0,1];return l[12]=-t[12]*l[0]-t[13]*l[4]-t[14]*l[8],l[13]=-t[12]*l[1]-t[13]*l[5]-t[14]*l[9],l[14]=-t[12]*l[2]-t[13]*l[6]-t[14]*l[10],l},le.transpose=function(t){return[t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]]},le.interpret=function(t){var e=[t[0],t[1],t[2]],i=g(e[0]),s=m(e),n=[e[0]+i*s,e[1],e[2]],o=2/_(n);if(o>=1/0)return{translate:le.getTranslate(t),rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]};var r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];r[0]=1-o*n[0]*n[0],r[5]=1-o*n[1]*n[1],r[10]=1-o*n[2]*n[2],r[1]=-o*n[0]*n[1],r[2]=-o*n[0]*n[2],r[6]=-o*n[1]*n[2],r[4]=r[1],r[8]=r[2],r[9]=r[6];var a=le.compose(r,t),h=[a[5],a[6]],u=g(h[0]),c=m(h),p=[h[0]+u*c,h[1]],l=2/_(p),d=[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1];d[5]=1-l*p[0]*p[0],d[10]=1-l*p[1]*p[1],d[6]=-l*p[0]*p[1],d[9]=d[6];var f=le.compose(d,r),v=le.compose(f,t),y=le.scale(v[0]<0?-1:1,v[5]<0?-1:1,v[10]<0?-1:1);v=le.compose(v,y),f=le.compose(y,f);var b={};return b.translate=le.getTranslate(t),b.rotate=[Math.atan2(-f[6],f[10]),Math.asin(f[2]),Math.atan2(-f[1],f[0])],b.rotate[0]||(b.rotate[0]=0,b.rotate[2]=Math.atan2(f[4],f[5])),b.scale=[v[0],v[5],v[10]],b.skew=[Math.atan2(v[9],b.scale[2]),Math.atan2(v[8],b.scale[2]),Math.atan2(v[4],b.scale[0])],Math.abs(b.rotate[0])+Math.abs(b.rotate[2])>1.5*Math.PI&&(b.rotate[1]=Math.PI-b.rotate[1],b.rotate[1]>Math.PI&&(b.rotate[1]-=2*Math.PI),b.rotate[1]<-Math.PI&&(b.rotate[1]+=2*Math.PI),b.rotate[0]<0?b.rotate[0]+=Math.PI:b.rotate[0]-=Math.PI,b.rotate[2]<0?b.rotate[2]+=Math.PI:b.rotate[2]-=Math.PI),b},le.build=function(t){var e=le.scale(t.scale[0],t.scale[1],t.scale[2]),i=le.skew(t.skew[0],t.skew[1],t.skew[2]),s=le.rotate(t.rotate[0],t.rotate[1],t.rotate[2]);return le.thenMove(le.compose(le.compose(s,i),e),t.translate)},le.average=function(t,e,i){i=void 0===i?.5:i;for(var s=le.interpret(t),n=le.interpret(e),o={translate:[0,0,0],rotate:[0,0,0],scale:[0,0,0],skew:[0,0,0]},r=0;3>r;r++)o.translate[r]=(1-i)*s.translate[r]+i*n.translate[r],o.rotate[r]=(1-i)*s.rotate[r]+i*n.rotate[r],o.scale[r]=(1-i)*s.scale[r]+i*n.scale[r],o.skew[r]=(1-i)*s.skew[r]+i*n.skew[r];return le.build(o)},le.equals=function(t,e){return!le.notEquals(t,e)},le.notEquals=function(t,e){return t===e?!1:!(t&&e)||t[12]!==e[12]||t[13]!==e[13]||t[14]!==e[14]||t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[4]!==e[4]||t[5]!==e[5]||t[6]!==e[6]||t[8]!==e[8]||t[9]!==e[9]||t[10]!==e[10]};var de=Date.now,fe=1e-9,ve={};b.prototype=Object.create(r.prototype),b.prototype.constructor=b,b.CURVES={linear:function(t){return t},easeIn:function(t){return t*t},easeOut:function(t){return t*(2-t)},easeInOut:function(t){return.5>=t?2*t*t:-2*t*t+4*t-1},easeOutBounce:function(t){return t*(3-2*t)},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return 1+Math.pow(t-1,3)},easeInOutCubic:function(t){return t*=2,1>t?.5*t*t*t:.5*Math.pow(t-2,3)+1},easeOutWall:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},b.DIMENSIONS=1/0,b.DEFAULT_OPTIONS={curve:b.CURVES.linear,duration:500},b.register=function(t,e){return ve[t]?!1:(ve[t]=e,!0)},b.deregister=function(t){return ve[t]?(delete ve[t],!0):!1},b.getCurves=function(){return ve},b.prototype.set=function(t,e){this._startValue=this.get(),this._active||(this.emit("start",this._startValue),this._active=!0),this._endValue=t,this._startTime=de();var i=e.curve;!ve[i]&&b.CURVES[i]&&b.register(i,b.CURVES[i]),this.velocity=e.velocity,this._duration=e.duration||b.DEFAULT_OPTIONS.duration,this._curve=i?i instanceof Function?i:O(i):b.DEFAULT_OPTIONS.curve},b.prototype.get=function(){return this.state},b.prototype.getVelocity=function(){return this.velocity},b.prototype.reset=function(t,e){this.state=t,this.velocity=e||0},b.prototype.halt=function(){var t=this.get();this.reset(t),this._active=!1,this.emit("end",t)},b.prototype.update=function(){if(this._active){var t=de()-this._startTime;if(this.velocity=E(this.state,this._startValue,this._curve,this._duration,1),t<this._duration){var e=t/this._duration;this.state=I(this._startValue,this._endValue,this._curve(e)),this.emit("update",this.state)}else this.emit("update",this._endValue),this.reset(this._endValue),this._active=!1,this.emit("end",this._endValue)}};var ye=Date.now,_e=1e-6,me=1e-9;A.DIMENSIONS=1,A.DEFAULT_OPTIONS={velocity:0,damping:.5,period:100},A.prototype=Object.create(r.prototype),A.prototype.constructor=A,A.prototype.set=function(t,e){var i=this.get();this._active||(this.emit("start",i),this._active=!0);var s=e.damping||A.DEFAULT_OPTIONS.damping,n=e.period||A.DEFAULT_OPTIONS.period,o=e.velocity||this.velocity;this.curve=D(s,n,i,t,o),this.energy=N(n);var r=S(t,i);this.energyTolerance=me*Math.pow(r,2),this.target=t,this.startTime=ye()},A.prototype.get=function(){return this.value},A.prototype.getVelocity=function(){return this.velocity},A.prototype.reset=function(t,e){this.value=t,this.velocity=e||0},A.prototype.halt=function(){if(this._active){var t=this.get();this.reset(t),this._active=!1,this.emit("end",t)}},A.prototype.isActive=function(){return this._active},A.prototype.update=function(){if(this._active){var t=ye()-this.startTime,e=this.curve(t),i=this.curve(t+_e),s=this.curve(t-_e);this.velocity=(i-s)/(2*_e);var n=this.energy(this.target,e,this.velocity);n>=this.energyTolerance?(this.value=e,this.emit("update",e)):(this.emit("update",this.target),this.reset(this.target),this._active=!1,this.emit("end",this.target))}};var ge=Date.now,be=1e-4;P.DIMENSIONS=1,P.DEFAULT_OPTIONS={velocity:0,drag:.1},P.prototype=Object.create(r.prototype),P.prototype.constructor=P,P.prototype.set=function(t,e){this._active||(this.emit("start",t),this._active=!0),this.value=t,this.drag=void 0==e.drag?P.DEFAULT_OPTIONS.drag:Math.pow(Math.min(e.drag,1),3),this.velocity=e.velocity||this.velocity},P.prototype.get=function(){return this.value},P.prototype.getVelocity=function(){return this.velocity},P.prototype.reset=function(t,e){this.value=t,this.velocity=e||0},P.prototype.halt=function(){if(this._active){var t=this.get();this.reset(t),this._active=!1,this.emit("end",t)}},P.prototype.isActive=function(){return this._active},P.prototype.update=function(){if(this._active){var t=ge(),e=t-this._previousTime;this._previousTime=t,this.velocity*=1-this.drag,this.value+=e*this.velocity;var i=.5*this.velocity*this.velocity;i>=be?this.emit("update",this.value):(this.emit("update",this.value),this.reset(this.value),this._active=!1,this.emit("end",this.value))}};var Oe={tween:b,spring:A,inertia:P};x.prototype=Object.create(r.prototype),x.prototype.constructor=x,x.register=function(t,e){t in Oe||(Oe[t]=e)},x.unregister=function(t){return t in Oe?(delete Oe[t],!0):!1},x.prototype.set=function(t,e,i){if(!e)return this.value=t,i&&i(),void(this.isActive()||(this.trigger("start",t),ne.push(function(){this.trigger("end",t)}.bind(this))));i&&(this._callback=i);var s=e.curve,n=s&&Oe[s]?Oe[s]:b;if(this._method!==n){if(this._engineInstance){if(this.updateMethod){var o=oe.indexOf(this.updateMethod);o>=0&&oe.splice(o,1)}this.unsubscribe(this._engineInstance)}if(this.value instanceof Array){var r=this.value.length;this._engineInstance=r<n.DIMENSIONS?new n(this.value):new L(this.value,n)}else this._engineInstance=new n(this.value);this.subscribe(this._engineInstance),this.updateMethod=this._engineInstance.update.bind(this._engineInstance),oe.push(this.updateMethod),this._method=n}e.velocity||(e.velocity=this.velocity),this._engineInstance.set(t,e)},x.prototype.get=function(){return this.value},x.prototype.getVelocity=function(){return this.velocity},x.prototype.reset=function(t,e){this.value=t,this.velocity=e||0,this._callback=null,this._method=null,this._engineInstance&&this._engineInstance.reset(t,e)},x.prototype.halt=function(){if(this._active&&(this.reset(this.get()),this.trigger("end",this.value),this._engineInstance)){if(this.updateMethod){var t=oe.indexOf(this.updateMethod);t>=0&&oe.splice(t,1)}this.unsubscribe(this._engineInstance)}},x.prototype.isActive=function(){return this._active},x.prototype.setMany=function(t,e){var i=t.shift();0===t.length?this.set(i[0],i[1],e):this.set(i[0],i[1],this.setMany.bind(this,t,e))},x.prototype.loop=function(t){var e=t.slice(0);this.setMany(t,this.loop.bind(this,e))},x.prototype.delay=function(t,e){this.set(this.get(),{duration:e,curve:function(){return 0}},t)},L.prototype.set=function(t,e){for(var i=e.velocity?e.velocity.slice():void 0,s=0;s<t.length;s++)i&&(e.velocity=i[s]),this.sources[s].set(t[s],e)},L.prototype.getVelocity=function(){for(var t=[],e=0;e<this.sources.length;e++)t[e]=this.sources[e].getVelocity();return t},L.prototype.update=function(){for(var t=0;t<this.sources.length;t++)this.sources[t].update()},L.prototype.reset=function(t){for(var e=0;e<this.sources.length;e++){var i=this.sources[e];i.reset(t[e])}};var Ie={OPACITY:1,TRANSFORM:le.identity,ORIGIN:null,ALIGN:null},Te=d.KEYS,we=u.KEYS;H.prototype.add=function(t){var e;return t.constructor===Object?Y.call(this,t):(t._isView?(this.root?t._node.root=this.root:this.tempRoot&&(t._node.tempRoot=this.tempRoot),e=t):(e=new H(t),this.tempRoot?e.tempRoot=this.tempRoot:e.root=X.call(this)),e._layout.subscribe(this.layout||this._layout),e._size.subscribe(this.size||this._size),e)},B.patch=function(t,e){for(var i=new B(t),s=1;s<arguments.length;s++)i.patch(arguments[s]);return t},B.setOptions=function(t,e,i){i=i||j(t.constructor.DEFAULT_OPTIONS)||{};var s=new B(i);return t.setOptions=B.prototype.setOptions.bind(s),t.getOptions=B.prototype.getOptions.bind(s),e&&t.setOptions(e),s.get()},B.prototype.patch=function(t,e){var i=this._value;for(var s in t)s in i&&t[s]&&t[s].constructor===Object&&i[s]&&i[s].constructor===Object?(i.hasOwnProperty(s)||(i[s]=Object.create(i[s])),this.key(s).patch(t[s]),this._eventHandler&&this._eventHandler.emit("change",{key:s,value:this.key(s).value()})):this.set(s,t[s]);return this},B.prototype.setOptions=B.prototype.patch,B.prototype.key=function yi(yi){var t=new B(this._value[yi]);return(!(t._value instanceof Object)||t._value instanceof Array)&&(t._value={}),t},B.prototype.get=function(t){return t?this._value[t]:this._value},B.prototype.getOptions=B.prototype.get,B.prototype.set=function(t,e){var i=this.get(t);return this._value[t]=e,this._eventHandler&&e!==i&&this._eventHandler.emit("change",{key:t,value:e}),this},B.prototype.on=function(t,e){U.call(this),i.prototype.on.apply(this._eventHandler,arguments)},B.prototype.off=function(t,e){U.call(this),i.prototype.off.apply(this._eventHandler,arguments)},G.DEFAULT_OPTIONS={},G.EVENTS={},G.prototype.getOptions=function(t){return B.prototype.getOptions.apply(this._optionsManager,arguments)},G.prototype.setOptions=function(){B.prototype.setOptions.apply(this._optionsManager,arguments)};var Ee={DEFAULTS:"defaults",EVENTS:"events"};G.extend=Z;var Ae=G.extend({_isView:!0,defaults:{size:null,origin:null,opacity:1},events:{change:K},constructor:function(t){this._size=new i,this._layout=new i,this._sizeNode=new d,this._layoutNode=new u,this._node=new H,this._node.tempRoot=this._node,this.size=p.lift(function(t,e){return e?t?F(t,e):e:!1},[this._sizeNode,this._size]),this._cachedSize=[0,0],this.size.on("resize",function(t){return t===this._cachedSize?!1:void(this._cachedSize=t)}.bind(this));var e=a.lift(function(t,e,i){return t&&i?e?R(e,t,i):t:!1}.bind(this),[this._layout,this._layoutNode,this.size]);this._node._size.subscribe(this.size),this._node._layout.subscribe(e),G.apply(this,arguments),this.options&&K.call(this,this.options)},add:function(){return H.prototype.add.apply(this._node,arguments)},getSize:function(){return this._cachedSize},setSize:function(t){this._sizeNode.set({size:t})},setProportions:function(t){this._sizeNode.set({proportions:t})},setAspectRatio:function(t){this._sizeNode.set({aspectRatio:t})},setOrigin:function(t){this._layoutNode.set({origin:t})},setOpacity:function(t){this._layoutNode.set({opacity:t})}}),Se=!("transform"in document.documentElement.style),De=2*(window.devicePixelRatio||1),Ne=1e-4,ze=.9999,Ce=1e-5,Me=[0,0],Pe=Se?function(t,e){t.style.webkitTransformOrigin=et(e)}:function(t,e){t.style.transformOrigin=et(e)},xe=Se?function(t,e,i){t.style.webkitTransform=tt(e,i)}:function(t,e,i){t.style.transform=tt(e,i)},Le=function(t,e){e[0]===!0?e[0]=t.offsetWidth:t.style.width=e[0]+"px",e[1]===!0?e[1]=t.offsetHeight:t.style.height=e[1]+"px"},Re=function(t,e){!this._isVisible&&e>Ne&&(t.style.visibility="visible",this._isVisible=!0),e>ze?e=ze:Ne>e&&(e=Ne,this._isVisible&&(t.style.visibility="hidden",this._isVisible=!1)),this._isVisible&&(t.style.opacity=e)};W.prototype.on=function(t,e){this._currentTarget&&this._currentTarget.addEventListener(t,this._eventForwarder),i.prototype.on.apply(this._eventOutput,arguments)},W.prototype.off=function(t,e){i.prototype.off.apply(this._eventOutput,arguments)},W.prototype.emit=function(t,e){i.prototype.emit.apply(this._eventOutput,arguments)},W.prototype.attach=function(t){this._currentTarget=t,J.call(this,t)},W.prototype.detach=function(){var t=this._currentTarget;t&&(Q.call(this,t),t.style.display=""),this._currentTarget=null};var ke="ontouchstart"in window,Fe=!("transform"in document.documentElement.style),He=/iPad|iPhone|iPod/.test(navigator.platform);ot.prototype=Object.create(W.prototype),ot.prototype.constructor=ot,ot.prototype.elementType="div",ot.prototype.elementClass="samsara-surface",ot.prototype.setAttributes=function(t){for(var e in t){var i=t[e];void 0!=i&&(this.attributes[e]=t[e])}return this._attributesDirty=!0,rt.call(this),this},ot.prototype.getAttributes=function(){return this.attributes},ot.prototype.setProperties=function(t){for(var e in t)this.properties[e]=t[e];return this._stylesDirty=!0,rt.call(this),this},ot.prototype.getProperties=function(){return this.properties},ot.prototype.addClass=function(t){return this.classList.indexOf(t)<0&&(this.classList.push(t),this._classesDirty=!0,rt.call(this)),this},ot.prototype.removeClass=function(t){var e=this.classList.indexOf(t);e>=0&&(this._dirtyClasses.push(this.classList.splice(e,1)[0]),this._classesDirty=!0,rt.call(this))},ot.prototype.toggleClass=function(t){var e=this.classList.indexOf(t);-1==e?this.addClass(t):this.removeClass(t)},ot.prototype.setClasses=function(t){for(var e=[],i=0;i<this.classList.length;i++)t.indexOf(this.classList[i])<0&&e.push(this.classList[i]);for(i=0;i<e.length;i++)this.removeClass(e[i]);for(i=0;i<t.length;i++)this.addClass(t[i]);return rt.call(this),this},ot.prototype.getClassList=function(){return this.classList},ot.prototype.setContent=function(t){return this.content!==t&&(this.content=t,this._contentDirty=!0,rt.call(this)),this},ot.prototype.getContent=function(){return this.content},ot.prototype.setOptions=function(t){void 0!==t.tagName&&(this.elementType=t.tagName),void 0!==t.opacity&&this.setOpacity(t.opacity),void 0!==t.size&&this.setSize(t.size),void 0!==t.origin&&this.setOrigin(t.origin),void 0!==t.proportions&&this.setProportions(t.proportions),void 0!==t.margins&&this.setMargins(t.margins),void 0!==t.classes&&this.setClasses(t.classes),void 0!==t.properties&&this.setProperties(t.properties),void 0!==t.attributes&&this.setAttributes(t.attributes),void 0!==t.content&&this.setContent(t.content),void 0!==t.aspectRatio&&this.setAspectRatio(t.aspectRatio),t.enableScroll&&dt.call(this),t.roundToPixel&&(this.roundToPixel=t.roundToPixel)},ot.prototype.setup=function(t){this._allocator=t;var e=t.allocate(this.elementType);if(this.elementClass)if(this.elementClass instanceof Array)for(var i=0;i<this.elementClass.length;i++)this.addClass(this.elementClass[i]);else this.addClass(this.elementClass);this.attach(e),at.call(this,e),ht.call(this,e),ut.call(this,e),this.deploy(e)},ot.prototype.remove=function(t){t=t||this._allocator;var e=this._currentTarget;this.recall(e),e.style.display="none",e.style.opacity="",e.style.width="",e.style.height="",Fe?(e.style.webkitTransform="scale3d(0.0001,0.0001,0.0001)",e.style.webkitTransformOrigin=""):(e.style.transform="scale3d(0.0001,0.0001,0.0001)",e.style.transformOrigin="");for(var i=0;i<this.classList.length;i++)this.removeClass(this.classList[i]);pt.call(this,e),lt.call(this,e),ct.call(this,e),this.detach(),t.deallocate(e)},ot.prototype.deploy=function(t){if(t){var e=this.getContent();if(e instanceof Node){for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}else t.innerHTML=e;this._contentDirty=!1,this._eventOutput.emit("deploy",t)}},ot.prototype.recall=function(t){this._eventOutput.emit("recall");for(var e=document.createDocumentFragment();t.hasChildNodes();)e.appendChild(t.firstChild);this.setContent(e)},ot.prototype.getSize=function(){return this._cachedSpec.size||this._cachedSize},ot.prototype.setSize=function(t){this._cachedSize=t,this._sizeNode.set({size:t}),rt.call(this)},ot.prototype.setProportions=function(t){this._sizeNode.set({proportions:t}),rt.call(this)},ot.prototype.setMargins=function(t){this._sizeNode.set({margins:t}),rt.call(this)},ot.prototype.setAspectRatio=function(t){this._sizeNode.set({aspectRatio:t}),rt.call(this)},ot.prototype.setOrigin=function(t){this._layoutNode.set({origin:t}),this._originDirty=!0,rt.call(this)},ot.prototype.setOpacity=function(t){this._layoutNode.set({opacity:t}),this._opacityDirty=!0,rt.call(this)},ft.prototype=Object.create(H.prototype),ft.prototype.constructor=ft,ft.prototype.setAllocator=function(t){this.allocator=t},vt.prototype.migrate=function(t){var e=this.container;if(t!==e){if(e instanceof DocumentFragment)t.appendChild(e);else for(;e.hasChildNodes();)t.appendChild(e.firstChild);this.container=t}},vt.prototype.allocate=function(t){t=t.toLowerCase(),t in this.detachedNodes||(this.detachedNodes[t]=[]);var e,i=this.detachedNodes[t];return 0===i.length?(e=document.createElement(t),this.container.appendChild(e)):e=i.pop(),e},vt.prototype.deallocate=function(t){var e=t.nodeName.toLowerCase(),i=this.detachedNodes[e];i.push(t)};var Ye="div",Xe=!1,Ve=/mobi/i.test(navigator.userAgent),Be=Number.NaN,Ue=Number.NaN,je=Number.NaN,Ge={transform:le.identity,opacity:1,origin:null,align:null,nextSizeTransform:le.identity};yt.prototype.elementClass="samsara-context",yt.DEFAULT_OPTIONS={enableScroll:!1},yt.prototype.add=function(){return ft.prototype.add.apply(this._node,arguments)},yt.prototype.getPerspective=function(){return this._perspective.get()},yt.prototype.setPerspective=function(t,e,i){this._perspective.set(t,e,i)},yt.prototype.setPerspectiveOrigin=function(t,e,i){this._perspectiveOrigin.set(t,e,i)},yt.prototype.mount=function(t,e){this.container=t||document.createElement(Ye),this.container.classList.add(this.elementClass);var i=new vt(this.container);this._node.setAllocator(i),this.emit("deploy",this.container),t||document.body.appendChild(this.container),e||window.addEventListener("resize",mt.bind(this),!1),se.push(function(){e||mt.call(this),this._layout.trigger("start",Ge),ne.push(function(){this._layout.trigger("end",Ge)}.bind(this))}.bind(this)),Xe||(Xe=!0,ae.start())},yt.prototype.on=function(t,e){this.container?this.container.addEventListener(t,this._eventForwarder):this._eventOutput.on("deploy",function(e){e.addEventListener(t,this._eventForwarder)}.bind(this)),i.prototype.on.apply(this._eventOutput,arguments)},yt.prototype.off=function(t,e){i.prototype.off.apply(this._eventOutput,arguments)},yt.prototype.emit=function(t,e){i.prototype.emit.apply(this._eventOutput,arguments)};var qe=!("perspective"in document.documentElement.style),Ze=qe?function(t,e){t.style.webkitPerspective=e?(0|e)+"px":"0px"}:function(t,e){t.style.perspective=e?(0|e)+"px":"0px"},Ke=qe?function(t,e){t.style.webkitPerspectiveOrigin=e?_t(e):"50% 50%"}:function(t,e){t.style.perspectiveOrigin=e?_t(e):"50% 50%"};gt.prototype=Object.create(ot.prototype),gt.prototype.constructor=gt,gt.prototype.elementType="div",gt.prototype.elementClass=["samsara-container","samsara-surface"],gt.prototype.getPerspective=function(){return yt.prototype.getPerspective.apply(this.context,arguments)},gt.prototype.setPerspective=function(){yt.prototype.setPerspective.apply(this.context,arguments)},gt.prototype.add=function(){return yt.prototype.add.apply(this.context,arguments)};var We={};bt.prototype=Object.create(r.prototype),bt.prototype.constructor=bt,bt.DIRECTION={X:0,Y:1},bt.register=function(t){for(var e in t){if(We[e]){if(We[e]===t[e])return;throw new Error("this key is registered to a different input class")}We[e]=t[e]}},bt.prototype.setOptions=function(t){for(var e in this._inputs)this._inputs[e].setOptions(t)},bt.prototype.subscribeInput=function(t){var e=this._inputs[t];e.subscribe(this._eventInput),this._eventOutput.subscribe(e)},bt.prototype.unsubscribeInput=function(t){var e=this._inputs[t];e.unsubscribe(this._eventInput),this._eventOutput.unsubscribe(e)},bt.prototype.getInput=function(t){return this._inputs[t]},bt.prototype.addInput=function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)Ot.call(this,t[e]);else if(t instanceof Object)for(var i in t)Ot.call(this,i,t[i])};var Je=8,Qe=Date.now;It.prototype=Object.create(r.prototype),It.prototype.constructor=It,It.DEFAULT_OPTIONS={direction:void 0,scale:1},It.DIRECTION={X:0,Y:1};var $e=Date.now;St.DEFAULT_OPTIONS={limit:1},St.prototype.track=function(t){this.touchHistory[t.identifier]=[t]};var ti=8;Mt.prototype=Object.create(r.prototype),Mt.prototype.constructor=Mt,Mt.DEFAULT_OPTIONS={direction:void 0,scale:1},Mt.DIRECTION={X:0,Y:1};var ei=8,ii=50;Rt.prototype=Object.create(r.prototype),Rt.prototype.constructor=Rt,Rt.DEFAULT_OPTIONS={direction:void 0,scale:1},Rt.DIRECTION={X:0,Y:1};var si=Date.now,ni=Date.now;Ft.prototype=Object.create(r.prototype),Ft.prototype.constructor=Ft,Ft.calculateAngle=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.atan2(s,i)},Ft.calculateDistance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},Ft.calculateCenter=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]},Ft.prototype.handleStart=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];this.touchAEnabled?this.touchBEnabled||(this.touchBId=i.identifier,this.touchBEnabled=!0,this.posB=[i.pageX,i.pageY],this.timestampB=ni(),this._startUpdate(t)):(this.touchAId=i.identifier,this.touchAEnabled=!0,this.posA=[i.pageX,i.pageY],this.timestampA=ni())}},Ft.prototype.handleMove=function(t){if(this.touchAEnabled&&this.touchBEnabled){for(var e,i=this.timestampA,s=this.timestampB,n=0;n<t.changedTouches.length;n++){var o=t.changedTouches[n];o.identifier===this.touchAId?(this.posA=[o.pageX,o.pageY],this.timestampA=ni(),e=this.timestampA-i):o.identifier===this.touchBId&&(this.posB=[o.pageX,o.pageY],this.timestampB=ni(),e=this.timestampB-s)}e&&this._moveUpdate(e)}},Ft.prototype.handleEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];(i.identifier===this.touchAId||i.identifier===this.touchBId)&&(this.touchAEnabled&&this.touchBEnabled&&this._eventOutput.emit("end",{touches:[this.touchAId,this.touchBId],angle:this._angle}),this.touchAEnabled=!1,this.touchAId=0,this.touchBEnabled=!1,this.touchBId=0)}},Ht.prototype=Object.create(Ft.prototype),Ht.prototype.constructor=Ht,Ht.DEFAULT_OPTIONS={scale:1},Ht.prototype._startUpdate=function(t){this._startDist=Ft.calculateDistance(this.posA,this.posB);var e=Ft.calculateCenter(this.posA,this.posB);this._eventOutput.emit("start",{count:t.touches.length,touchIds:[this.touchAId,this.touchBId],distance:this._startDist,center:e})},Ht.prototype._moveUpdate=function(t){var e=this.options.scale,i=Ft.calculateDistance(this.posA,this.posB),s=Ft.calculateCenter(this.posA,this.posB),n=(i-this._startDist)/this._startDist,o=Math.max(1+e*n,0),r=(o-this._scaleFactor)/t;this._eventOutput.emit("update",{delta:n,scale:o,velocity:r,distance:i,center:s,touchIds:[this.touchAId,this.touchBId]}),this._scaleFactor=o},Yt.prototype=Object.create(Ft.prototype),Yt.prototype.constructor=Yt,Yt.DEFAULT_OPTIONS={scale:1},Yt.prototype._startUpdate=function(t){this._previousAngle=Ft.calculateAngle(this.posA,this.posB);var e=Ft.calculateCenter(this.posA,this.posB);this._angle=0,this._eventOutput.emit("start",{count:t.touches.length,value:this._angle,center:e,touchIds:[this.touchAId,this.touchBId]})},Yt.prototype._moveUpdate=function(t){var e=this.options.scale,i=Ft.calculateAngle(this.posA,this.posB),s=Ft.calculateCenter(this.posA,this.posB),n=e*(i-this._previousAngle),o=n/t;this._angle+=n,this._eventOutput.emit("update",{delta:n,velocity:o,value:this._angle,center:s,touchIds:[this.touchAId,this.touchBId]}),this._previousAngle=i},Xt.prototype=Object.create(Ft.prototype),Xt.prototype.constructor=Xt,Xt.DEFAULT_OPTIONS={scale:1},Xt.prototype._startUpdate=function(t){var e=Ft.calculateCenter(this.posA,this.posB);this._previousDistance=Ft.calculateDistance(this.posA,this.posB),this._displacement=0,this._eventOutput.emit("start",{count:t.touches.length,touchIds:[this.touchAId,this.touchBId],value:this._previousDistance,center:e})},Xt.prototype._moveUpdate=function(t){var e=Ft.calculateDistance(this.posA,this.posB),i=Ft.calculateCenter(this.posA,this.posB),s=this.options.scale,n=s*(e-this._previousDistance),o=n/t;this._displacement+=n,this._eventOutput.emit("update",{delta:n,velocity:o,value:e,displacement:this._displacement,center:i,touchIds:[this.touchAId,this.touchBId]}),this._previousDistance=e},Vt.DEFAULT_OPTIONS={scale:1},Vt.prototype=Object.create(a.prototype),Vt.prototype.constructor=Vt,Bt.prototype=Object.create(a.prototype),Bt.prototype.constructor=Bt,Bt.DEFAULT_OPTIONS={min:-(1/0),max:1/0},Bt.prototype.set=function(t,e){if(this.sum=t,e!==!0){var i=this;se.push(function(){i.trigger("start",t),ne.push(function(){i.trigger("end",t)})})}},Bt.prototype.get=function(){return this.sum};var oi={DIRECTION:{X:0,Y:1},SIDE:{LEFT:0,TOP:1,RIGHT:2,BOTTOM:3},ORIENTATION:{POSITIVE:1,NEGATIVE:-1}},ri=Ae.extend({defaults:{side:oi.SIDE.LEFT,revealLength:void 0,velocityThreshold:1/0,positionThreshold:0,transitionOpen:!0,transitionClose:!0},events:{change:qt},initialize:function(t){this.direction=jt(t.side),this.orientation=Gt(t.side),this.options.revealLength*=this.orientation,this.isOpen=!1,this.transitionStream=new x(0);var e=new a({start:function(){return this.transitionStream.halt(),0}.bind(this),update:function(e){var i=e.delta,s=i,n=t.revealLength,o=this.position.get(),r=o+i,a=0,h=0;return this.orientation===oi.ORIENTATION.POSITIVE?h=n:a=n,(r>=h||a>=r)&&(s=r>h&&r>a&&o!==h?h-o:a>r&&o!==a?a-o:0),s}.bind(this),end:function(e){var i=e.velocity,s=this.orientation,n=this.position.get(),o=t.revealLength,r=s*o,a=t.positionThreshold||r/2,h=t.velocityThreshold;if(0===n)return this.isOpen=!1,!1;if(n===r)return this.isOpen=!0,!1;var u=n>=a&&(i>-h||i>h)||a>n&&i>h;u?(this.options.transitionOpen.velocity=i,this.open(this.options.transitionOpen,function(){this.options.transitionOpen.velocity=0}.bind(this))):(this.options.transitionClose.velocity=i,this.close(this.options.transitionClose,function(){this.options.transitionClose.velocity=0}.bind(this)))}.bind(this)});e.subscribe(this.input);var i=new Vt;i.subscribe(this.transitionStream),this.position=new Bt(0),this.position.subscribe(e),this.position.subscribe(i);var n=new s(function(t){return{value:t,progress:t/this.options.revealLength}}.bind(this));this.output.subscribe(n).subscribe(this.position)},addDrawer:function(t){void 0==this.options.revealLength&&(this.options.revealLength=t.getSize()[this.direction]),this.drawer=t;var e=new u({transform:le.behind});this.add(e).add(this.drawer)},addContent:function(t){var e=this.position.map(function(t){return this.direction===oi.DIRECTION.X?le.translateX(t):le.translateY(t)}.bind(this)),i=new u({transform:e});this.add(i).add(t)},open:function(t,e){void 0===t&&(t=this.options.transitionOpen),this.setPosition(this.options.revealLength,t,e),this.isOpen||(this.isOpen=!0,this.emit("open"))},close:function(t,e){void 0===t&&(t=this.options.transitionClose),this.setPosition(0,t,e),this.isOpen&&(this.isOpen=!1,this.emit("close"))},toggle:function(t){this.isOpen?this.close(t):this.open(t)},setPosition:function(t,e,i){this.transitionStream.reset(this.position.get()),this.transitionStream.set(t,e,i)},reset:function(t){this.isOpen?this.open(t):this.close(t)}},oi),ai={DIRECTION:{X:0,Y:1}},hi=Ae.extend({defaults:{direction:ai.DIRECTION.X,ratios:[]},initialize:function(t){var e=t.ratios instanceof x?t.ratios:new x(t.ratios);this.nodes=[];var i=a.lift(function(e,i){for(var s=t.direction,n=i[s],o=0,r=0;r<e.length;r++){var a=e[r],h=this.nodes[r];"number"!=typeof a?n-=h.getSize()[s]||0:o+=a}for(var u=0,c=[],p=[],r=0;r<e.length;r++){h=this.nodes[r],a=e[r];var l="number"==typeof a?n*a/o:h.getSize()[s],d=s==ai.DIRECTION.X?le.translateX(u):le.translateY(u),f=s==ai.DIRECTION.X?[l,void 0]:[void 0,l];p.push(f),c.push(d),u+=l}return{transforms:c,sizes:p}}.bind(this),[e,this.size]);this.transforms=i.pluck("transforms"),this.sizes=i.pluck("sizes")},addItems:function(t){this.nodes=t;for(var e=0;e<this.nodes.length;e++){var i=this.nodes[e],s=new u({transform:this.transforms.pluck(e)}),n=new d({size:this.sizes.pluck(e)});this.add(s).add(n).add(i)}}},ai),ui=Ae.extend({defaults:{itemsPerRow:[],gutter:0},events:{},initialize:function(t){var e=t.gutter instanceof x?t.gutter:new x(t.gutter);this.stream=a.lift(function(e,i){if(!e)return!1;for(var s=e[0],n=e[1],o=t.itemsPerRow instanceof Array?t.itemsPerRow:Zt(t.itemsPerRow,s),r=o.length,a=(n-(r-1)*i)/r,h=[],u=[],c=0,p=0;r>p;p++){for(var l=o[p],d=(s-(l-1)*i)/l,f=0,v=0;l>v;v++){var e=[d,a];h.push(e),u.push([f,c]),f+=d+i}c+=a+i}return{sizes:h,positions:u}},[this.size,e])},addItems:function(t){for(var e=this.stream.pluck("sizes"),i=this.stream.pluck("positions"),s=0;s<t.length;s++){
var n=t[s],o=e.pluck(s),r=i.pluck(s),a=r.map(function(t){return le.translate(t)}),o=new d({size:o}),h=new u({transform:a});this.add(o).add(h).add(n)}}}),ci={DIRECTION:{X:0,Y:1}},pi=Ae.extend({defaults:{direction:ci.DIRECTION.X,spacing:0},initialize:function(){},addItems:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].size);var s=p.lift(function(){for(var t=arguments,e=this.options.direction,i=[],s=0,n=0;n<t.length;n++){var o=t[n],r=e===ci.DIRECTION.X?le.translateX(s):le.translateY(s);i.push(r),s+=o[e]+this.options.spacing}return{transforms:i,length:s}}.bind(this),e),n=s.pluck("transforms"),o=s.pluck("length");this.output.subscribe(o);for(var i=0;i<t.length;i++){var r=t[i],a=n.pluck(i),h=new u({transform:a});this.add(h).add(r)}}},ci);bt.register({touch:Mt,scroll:Rt});var li={DIRECTION:{X:0,Y:1}},di={TOP:-1,BOTTOM:1,NONE:0},fi=Ae.extend({defaults:{direction:li.DIRECTION.Y,drag:.3,paginated:!1,pageChangeSpeed:.5,startPosition:0,marginTop:0,marginBottom:0,clip:!0,pageTransition:{curve:"spring",period:100,damping:.8},edgeTransition:{curve:"spring",period:100,damping:1},edgeGrip:.5},initialize:function(t){this._currentIndex=0,this._previousIndex=0,this.itemOffset=0,this.items=[],this.velocity=0;var e=!1;this.overflow=0;var i=di.NONE,s=void 0!==window.ontouchstart;this.layout=new pi({direction:t.direction});var n=new bt(["touch","scroll"],{direction:t.direction}),o=new Bt(-t.startPosition);this.drag=new x(0),this.spring=new x(0);var r=new Vt,h=new Vt,c=n.pluck("delta");r.subscribe(this.drag),h.subscribe(this.spring),o.subscribe(c),o.subscribe(r),o.subscribe(h),n.on("start",function(){e=!0,this.drag.halt(),this.spring.halt()}.bind(this)),n.on("update",function(t){this.velocity=t.velocity}.bind(this)),n.on("end",function(t){switch(e=!1,i){case di.NONE:this.options.paginated?Jt.call(this,t.velocity):Qt.call(this,t.velocity);break;case di.TOP:Wt.call(this,this.overflow,t.velocity);break;case di.BOTTOM:Wt.call(this,this.overflow,t.velocity)}}.bind(this)),this.drag.on("update",function(){this.velocity=this.drag.getVelocity()}.bind(this)),this.spring.on("update",function(){this.velocity=this.spring.getVelocity()}.bind(this)),o.on("end",function(){this.spring.isActive()||Kt.call(this,this._currentIndex)}.bind(this));var l=p.lift(function(e,i){if(!e)return!1;var s=i[t.direction]-t.marginBottom-e;return s>=0?!1:s},[this.layout,this.size]);this.offset=a.lift(function(t,r){if(!r)return!1;if(this.spring.isActive())return Math.round(t);if(t>0){if(!s)return i=di.TOP,o.set(0,!0),Kt.call(this,this._currentIndex),0;this.overflow=t,i!==di.TOP&&(n.setOptions({scale:this.options.edgeGrip}),i=di.TOP,e||Wt.call(this,this.overflow,this.velocity))}else if(r>t){if(!s)return i=di.BOTTOM,o.set(r,!0),Kt.call(this,this._currentIndex),r;this.overflow=t-r,i!==di.BOTTOM&&(n.setOptions({scale:.5}),i=di.BOTTOM,e||Wt.call(this,this.overflow,this.velocity))}else t>r&&0>t&&i!==di.NONE&&(this.overflow=0,n.setOptions({scale:1}),i=di.NONE);return Math.round(t)}.bind(this),[o,l]);var d=new u({transform:this.offset.map(function(e){return e+=t.marginTop,t.direction==li.DIRECTION.Y?le.translateY(e):le.translateX(e)})});this.container=new gt({properties:{overflow:"hidden"}}),n.subscribe(this.container),this.container.add(d).add(this.layout),this.add(this.container)},setPerspective:function(){gt.prototype.setPerspective.apply(this.container,arguments)},getVelocity:function(){return this.velocity},goTo:function(t,e,i){e=e||this.options.pageTransition;var s=this.itemOffset;if(t>this._currentIndex&&t<this.items.length)for(var n=this._currentIndex;t>n;n++)s-=this.items[n].getSize()[this.options.direction];else if(t<this._currentIndex&&t>=0)for(var n=this._currentIndex;n>t;n--)s+=this.items[n].getSize()[this.options.direction];this.spring.halt(),this.spring.reset(0),this.spring.set(Math.ceil(s),e,i)},getCurrentIndex:function(){return this._currentIndex},addItems:function(t){this.layout.addItems(t),this.items=t;for(var e=[this.offset],i=0;i<t.length;i++)e.push(t[i].size);var s=0,n=a.lift(function(){if(void 0===arguments[0]||void 0===arguments[1])return!1;var e=arguments[0],i=this.options.direction,n=this._currentIndex,o=arguments[n+1];if(!o)return!1;var r=0,a=-e-s,h=o[i];return a>=h&&this._currentIndex!==t.length-1?(this._currentIndex++,r=0,s+=h):0>a&&0!==this._currentIndex?(this._currentIndex--,r=1,h=arguments[this._currentIndex+1][i],s-=h):r=a/h,this.itemOffset=a,{index:this._currentIndex,progress:r}}.bind(this),e);this.output.subscribe(n),n.on("start",function(){}),n.on("update",function(){}),n.on("end",function(){})}},li);t.Engine=ae,t.LayoutNode=u,t.SizeNode=d,t.Timer=ce,t.Transform=le,t.Transitionable=x,t.View=Ae,t.Surface=ot,t.ContainerSurface=gt,t.Context=yt,t.EventEmitter=e,t.EventHandler=i,t.EventMapper=s,t.EventFilter=n,t.EventSplitter=o,t.GenericInput=bt,t.MouseInput=It,t.TouchInput=Mt,t.ScrollInput=Rt,t.ScaleInput=Ht,t.RotateInput=Yt,t.PinchInput=Xt,t.DrawerLayout=ri,t.FlexibleLayout=hi,t.GridLayout=ui,t.SequentialLayout=pi,t.Scrollview=fi,t.Accumulator=Bt,t.Differential=Vt,t.SimpleStream=r,t.Stream=a,t.Observable=h,t.SizeObservable=l,t.Tween=b,t.Spring=A,t.Inertia=P});