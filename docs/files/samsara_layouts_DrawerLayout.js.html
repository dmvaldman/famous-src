<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>samsara/layouts/DrawerLayout.js - SamsaraJS</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
        <!---->
	    <!--<img alt="SamsaraJS" src="../assets/css/logo.png" style="max-height: 65%;" title="SamsaraJS">-->
        <!---->
            SamsaraJS
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>0.2.2</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes..." data-obj='["classes/Core.Controller", "classes/Core.DOMAllocator", "classes/Core.DOMOutput", "classes/Core.Engine", "classes/Core.LayoutNode", "classes/Core.Node", "classes/Core.OptionsManager", "classes/Core.RenderTreeNode", "classes/Core.RootNode", "classes/Core.SizeNode", "classes/Core.Timer", "classes/Core.Transform", "classes/Core.Transitionable", "classes/Core.View", "classes/DOM.ContainerSurface", "classes/DOM.Context", "classes/DOM.Surface", "classes/Events.EventEmitter", "classes/Events.EventFilter", "classes/Events.EventHandler", "classes/Events.EventMapper", "classes/Events.EventSplitter", "classes/Inputs.GenericInput", "classes/Inputs.MouseInput", "classes/Inputs.PinchInput", "classes/Inputs.RotateInput", "classes/Inputs.ScaleInput", "classes/Inputs.ScrollInput", "classes/Inputs.TouchInput", "classes/Inputs.TouchTracker", "classes/Inputs.TwoFingerInput", "classes/Layouts.BidirectionalList", "classes/Layouts.DrawerLayout", "classes/Layouts.FlexLayout", "classes/Layouts.GridLayout", "classes/Layouts.HeaderFooterLayout", "classes/Layouts.SequentialLayout", "classes/Streams.Accumulator", "classes/Streams.Differential", "classes/Streams.Observable", "classes/Streams.SimpleStream", "classes/Streams.Stream", "classes/Transitions.Inertia", "classes/Transitions.Spring", "classes/Transitions.Tween", "classes/UI.Fingers", "classes/UI.Slider"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <!--<h3>APIs</h3>-->
	        <br>
	        <div id="sidebar">
	            <!--<ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">-->
	                <!--<li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>-->
	                <!--<li><a href="#modules" data-toggle="tab">Modules</a></li>-->
	            <!--</ul>-->
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/Core.Timer.html">Core.Timer</a></li>
	                            <li><a href="../classes/Core.Transform.html">Core.Transform</a></li>
	                            <li><a href="../classes/Core.Transitionable.html">Core.Transitionable</a></li>
	                            <li><a href="../classes/Core.View.html">Core.View</a></li>
	                            <li><a href="../classes/DOM.ContainerSurface.html">DOM.ContainerSurface</a></li>
	                            <li><a href="../classes/DOM.Context.html">DOM.Context</a></li>
	                            <li><a href="../classes/DOM.Surface.html">DOM.Surface</a></li>
	                            <li><a href="../classes/Events.EventEmitter.html">Events.EventEmitter</a></li>
	                            <li><a href="../classes/Events.EventFilter.html">Events.EventFilter</a></li>
	                            <li><a href="../classes/Events.EventHandler.html">Events.EventHandler</a></li>
	                            <li><a href="../classes/Events.EventMapper.html">Events.EventMapper</a></li>
	                            <li><a href="../classes/Inputs.GenericInput.html">Inputs.GenericInput</a></li>
	                            <li><a href="../classes/Inputs.MouseInput.html">Inputs.MouseInput</a></li>
	                            <li><a href="../classes/Inputs.PinchInput.html">Inputs.PinchInput</a></li>
	                            <li><a href="../classes/Inputs.RotateInput.html">Inputs.RotateInput</a></li>
	                            <li><a href="../classes/Inputs.ScaleInput.html">Inputs.ScaleInput</a></li>
	                            <li><a href="../classes/Inputs.ScrollInput.html">Inputs.ScrollInput</a></li>
	                            <li><a href="../classes/Inputs.TouchInput.html">Inputs.TouchInput</a></li>
	                            <li><a href="../classes/Layouts.BidirectionalList.html">Layouts.BidirectionalList</a></li>
	                            <li><a href="../classes/Layouts.DrawerLayout.html">Layouts.DrawerLayout</a></li>
	                            <li><a href="../classes/Layouts.FlexLayout.html">Layouts.FlexLayout</a></li>
	                            <li><a href="../classes/Layouts.GridLayout.html">Layouts.GridLayout</a></li>
	                            <li><a href="../classes/Layouts.HeaderFooterLayout.html">Layouts.HeaderFooterLayout</a></li>
	                            <li><a href="../classes/Layouts.SequentialLayout.html">Layouts.SequentialLayout</a></li>
	                            <li><a href="../classes/Streams.Accumulator.html">Streams.Accumulator</a></li>
	                            <li><a href="../classes/Streams.Differential.html">Streams.Differential</a></li>
	                            <li><a href="../classes/Streams.Stream.html">Streams.Stream</a></li>
	                            <li><a href="../classes/UI.Fingers.html">UI.Fingers</a></li>
	                            <li><a href="../classes/UI.Slider.html">UI.Slider</a></li>
	                    </ul>
	                </div>
	    
	                <!--<div class="tab-pane" id="modules">-->
	                    <!--<ul id="api-modules" class="nav nav-list">-->
	                        <!---->
	                    <!--</ul>-->
	                <!--</div>-->
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>samsara/layouts/DrawerLayout.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
/* Copyright Â© 2015-2016 David Valdman */

define(function(require, exports, module) {
    var Transform = require(&#x27;../core/Transform&#x27;);
    var Transitionable = require(&#x27;../core/Transitionable&#x27;);
    var View = require(&#x27;../core/View&#x27;);
    var Stream = require(&#x27;../streams/Stream&#x27;);
    var Differential = require(&#x27;../streams/Differential&#x27;);
    var Accumulator = require(&#x27;../streams/Accumulator&#x27;);
    var EventMapper = require(&#x27;../events/EventMapper&#x27;);

    var CONSTANTS = {
        DIRECTION : {
            X : 0,
            Y : 1
        },
        SIDE : {
            LEFT : 0,
            TOP : 1,
            RIGHT : 2,
            BOTTOM : 3
        },
        ORIENTATION : {
            POSITIVE :  1,
            NEGATIVE : -1
        }
    };

    /**
     * A layout composed of two sections: content and drawer.
     *
     *  The drawer is initially hidden behind the content, until it is moved
     *  by a call to setPosition. The source of the movement can be by subscribing
     *  the layout to user input (like a Mouse/Touch/Scroll input), or by manually
     *  calling setPosition with a transition.
     *
     *  The layout emits a &#x60;start&#x60;, &#x60;update&#x60; and &#x60;end&#x60; Stream with payload
     *
     *      &#x60;progress&#x60; - Number between 0 and 1 indicating how open the drawer is
     *      &#x60;value&#x60; - Pixel displacement in how open the drawer is
     *
     *  It also emits &#x60;close&#x60; and &#x60;open&#x60; events.
     *
     *  The drawer can be revealed from any side of the content (top, left, bottom, right),
     *  by specifying a side option.
     *
     *  @class DrawerLayout
     *  @constructor
     *  @namespace Layouts
     *  @extends Core.View
     *  @param [options] {Object}                       Options
     *  @param [options.side] {Number}                  Side to reveal the drawer from. Defined in DrawerLayout.SIDES
     *  @param [options.revealLength] {Number}          The maximum length to reveal the drawer
     *  @param [options.velocityThreshold] {Number}     The velocity needed to complete the drawer transition
     *  @param [options.positionThreshold] {Number}     The displacement needed to complete the drawer transition
     *  @param [options.transitionClose] {Object}       A transition definition for closing the drawer
     *  @param [options.transitionOpen] {Object}        A transition definition for opening the drawer
     */
    var DrawerLayout = View.extend({
        defaults : {
            side : CONSTANTS.SIDE.LEFT,
            revealLength : undefined,
            velocityThreshold : Infinity,
            positionThreshold : 0,
            transitionOpen : true,
            transitionClose : true
        },
        events : {
            change : _updateState
        },
        initialize : function initialize(options){
            // DERIVED STATE

            // vertical or horizontal movement
            this.direction = _getDirectionFromSide(options.side);

            // positive or negative movement along the direction
            this.orientation = _getOrientationFromSide(options.side);

            // scale the revealLength by the parity of the direction
            this.options.revealLength *= this.orientation;

            // open state (needed for toggling)
            this.isOpen = false;

            // STREAMS
            
            // responsible for manually moving the content without user input
            this.transitionStream = new Transitionable(0);

            // responsible for moving the content from user input
            var gestureDelta = new Stream({
                start : function (){
                    this.transitionStream.halt();
                    return 0;
                }.bind(this),
                update : function (data){
                    // modify the delta from user input to be constrained
                    // by the revealLength
                    var delta = data.delta;
                    var newDelta = delta;
                    var revealLength = options.revealLength;

                    var currentPosition = this.position.get();
                    var newPosition = currentPosition + delta;

                    var MIN_LENGTH = 0;
                    var MAX_LENGTH = 0;

                    if (this.orientation === CONSTANTS.ORIENTATION.POSITIVE)
                        MAX_LENGTH = revealLength;
                    else
                        MIN_LENGTH = revealLength;

                    if (newPosition &gt;= MAX_LENGTH || newPosition &lt;= MIN_LENGTH){
                        if (newPosition &gt; MAX_LENGTH &amp;&amp; newPosition &gt; MIN_LENGTH &amp;&amp; currentPosition !== MAX_LENGTH)
                            newDelta = MAX_LENGTH - currentPosition;
                        else if (newPosition &lt; MIN_LENGTH &amp;&amp; currentPosition !== MIN_LENGTH)
                            newDelta = MIN_LENGTH - currentPosition;
                        else
                            newDelta = 0;
                    }

                    return newDelta;
                }.bind(this),
                end : function (data){
                    var velocity = data.velocity;

                    var orientation = this.orientation;
                    var position = this.position.get();

                    var length = options.revealLength;
                    var MAX_LENGTH = orientation * length;
                    var positionThreshold = options.positionThreshold || MAX_LENGTH / 2;
                    var velocityThreshold = options.velocityThreshold;

                    if (position === 0) {
                        this.isOpen = false;
                        return false;
                    }

                    if (position === MAX_LENGTH) {
                        this.isOpen = true;
                        return false;
                    }

                    var shouldOpen =
                        (position &gt;= positionThreshold) &amp;&amp; ((velocity &gt; -velocityThreshold) || (velocity &gt; velocityThreshold)) ||
                        (position &lt;  positionThreshold) &amp;&amp; ((velocity &gt;  velocityThreshold));

                    if (shouldOpen){
                        this.options.transitionOpen.velocity = velocity;
                        this.open(this.options.transitionOpen, function(){
                            this.options.transitionOpen.velocity = 0;
                        }.bind(this));
                    }
                    else {
                        this.options.transitionClose.velocity = velocity;
                        this.close(this.options.transitionClose, function(){
                            this.options.transitionClose.velocity = 0;
                        }.bind(this));
                    }
                }.bind(this)
            });

            gestureDelta.subscribe(this.input);

            var transitionDelta = new Differential();
            transitionDelta.subscribe(this.transitionStream);

            this.position = new Accumulator(0);
            this.position.subscribe(gestureDelta);
            this.position.subscribe(transitionDelta);

            var outputMapper = new EventMapper(function(position){
                return {
                    value : position,
                    progress : position / this.options.revealLength
                }
            }.bind(this));

            this.output.subscribe(outputMapper).subscribe(this.position);
        },
        /**
         * Set the drawer component with a Surface of View.
         *
         * @method addDrawer
         * @param drawer {Surface|View}
         */
        addDrawer : function addDrawer(drawer){
            if (this.options.revealLength === undefined)
                this.options.revealLength = drawer.getSize()[this.direction];

            this.drawer = drawer;
            this.add({transform : Transform.behind}).add(this.drawer);
        },
        /**
         * Set the content component with a Surface or View.
         *
         * @method addContent
         * @param content {Surface|View}
         */
        addContent : function addContent(content){
            var transform = this.position.map(function(position){
                return (this.direction === CONSTANTS.DIRECTION.X)
                    ? Transform.translateX(position)
                    : Transform.translateY(position)
            }.bind(this));

            this.add({transform : transform}).add(content);
        },
        /**
         * Reveals the drawer with a transition.
         *   Emits an &#x60;open&#x60; event when an opening transition has been committed to.
         *
         * @method open
         * @param [transition] {Boolean|Object} transition definition
         * @param [callback] {Function}         callback
         */
        open : function open(transition, callback){
            if (transition === undefined) transition = this.options.transitionOpen;
            this.setPosition(this.options.revealLength, transition, callback);
            if (!this.isOpen) {
                this.isOpen = true;
                this.emit(&#x27;open&#x27;);
            }
        },
        /**
         * Conceals the drawer with a transition.
         *   Emits a &#x60;close&#x60; event when an closing transition has been committed to.
         *
         * @method close
         * @param [transition] {Boolean|Object} transition definition
         * @param [callback] {Function}         callback
         */
        close : function close(transition, callback){
            if (transition === undefined) transition = this.options.transitionClose;
            this.setPosition(0, transition, callback);
            if (this.isOpen){
                this.isOpen = false;
                this.emit(&#x27;close&#x27;);
            }
        },
        /**
         * Toggles between open and closed states.
         *
         * @method toggle
         * @param [transition] {Boolean|Object} transition definition
         */
        toggle : function toggle(transition){
            if (this.isOpen) this.close(transition);
            else this.open(transition);
        },
        /**
         * Sets the position in pixels for the content&#x27;s displacement.
         *
         * @method setPosition
         * @param position {Number}             position
         * @param [transition] {Boolean|Object} transition definition
         * @param [callback] {Function}         callback
         */
        setPosition : function setPosition(position, transition, callback) {
            this.transitionStream.reset(this.position.get());
            this.transitionStream.set(position, transition, callback);
        },
        /**
         * Resets to last state of being open or closed
         *
         * @method reset
         * @param [transition] {Boolean|Object} transition definition
         */
        reset : function reset(transition) {
            if (this.isOpen) this.open(transition);
            else this.close(transition);
        }
    }, CONSTANTS);

    function _getDirectionFromSide(side) {
        var SIDE = CONSTANTS.SIDE;
        var DIRECTION = CONSTANTS.DIRECTION;
        return (side === SIDE.LEFT || side === SIDE.RIGHT)
            ? DIRECTION.X
            : DIRECTION.Y;
    }

    function _getOrientationFromSide(side) {
        var SIDES = CONSTANTS.SIDE;
        return (side === SIDES.LEFT || side === SIDES.TOP)
            ? CONSTANTS.ORIENTATION.POSITIVE
            : CONSTANTS.ORIENTATION.NEGATIVE;
    }

    function _updateState(data){
        var key = data.key;
        var value = data.value;
        if (key !== &#x27;side&#x27;) {
            this.direction = _getDirectionFromSide(value);
            this.orientation = _getOrientationFromSide(value);
        }
        this.options.revealLength *= this.direction;
    }

    module.exports = DrawerLayout;
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
